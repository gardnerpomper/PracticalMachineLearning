# Prediction of exercise type from instrumentation readings

writeup for Coursera's Practical Machine Learning Final Project

# Data

Data was provided for the exercise from the following url: https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv

It consists of timestamped measurements from varying instruments,
along with a user name and the type of exercise they were doing at the
time. This will provide both the training and test data for this
analysis.

## Loading

The data is loaded from the file, which was copied to the current directory:

```{r loadData,cache=TRUE,results="hide"}
library(caret)
library(doMC)

registerDoMC(3) # allow 2 cores for processing
set.seed(12345)
raw.df <- read.csv("pml-training.csv",na.strings=c("NA",""))
```

## Preprocessing

There are two types of events in the file. One is the raw collection
of instrumentation readings. The other is the statistical information
for a 1 second time period of the raw data. This statistical
information is marked with a field named "new_window" and a value of
"yes". The analysis is done on only the raw data, since the
statistical information (mean, max, etc) is of a different type that
the bulk of the information. This code restricts to just the raw
information:

```{r limitColumns,cache=TRUE}
whole.window <- raw.df$new_window != "yes"
window.df <- raw.df[whole.window,c(160,8:159)]
##
## make sure all the values are numeric, not factors
##
window.df[,-c(1)] <- sapply(window.df[,-c(1)],function(x){ as.numeric(as.character(x))})
##
## figure out which columns have values in them and eliminate the rest
##
nsv <- nearZeroVar(window.df,saveMetrics=TRUE)
window.df <- window.df[,nsv$nzv == FALSE]
```

## Splitting into training and testing datasets

In order to do cross validation, the data is split into 2 sets; one
for training the model and one for testing the accuracy. Because there
are many observations and the model chosen (random forest) is
computationally expensive, the training set is restricted to 3000
observations.

```{r createTraining, cache=TRUE}
inTrain <- sample(nrow(window.df),3000)

training.raw <- window.df[inTrain,]
testing.raw <- window.df[-inTrain,]
```

## Imputing missing values

The observations have occasional missing values, which messed up the learning algorithsm. The missing values are imputed using the knn preprocess method:

```{r imputeValues,cache=TRUE}
predictors <- subset(training.raw,select=-c(classe))
preObj <- preProcess(predictors,method="knnImpute")
training <- predict(preObj,predictors)
training$classe <- training.raw$classe

testing <- predict(preObj,subset(testing.raw,select=-c(classe)))
testing$classe <- testing.raw$classe
```

# Modelling

Several modelling approaches were taken. For each approach, the model
is trained with the training data set and tested against the test data
set. The matrix of predicted versus actual values, along with the
confusion matrix is printed. The accuracy and out of sample error
stats are saved and reported at the end, by model.

## Tree classifier

```{r treeModel,cache=TRUE}
modFit <- train(classe ~ ., method="rpart",data=training)
pred <- predict(modFit,testing)
tree.cm <- confusionMatrix(testing$classe,pred)
print( tree.cm)
```

## Linear Discriminate Analysis

```{r ldaModel, cache=TRUE}
modFit <- train(classe ~ ., data=training,method="lda")
pred <- predict(modFit,testing)
lda.cm <- confusionMatrix(testing$classe,pred)
print( lda.cm)
```

## Boosting

```{r boostModel, cache=TRUE}
modFit <- train(classe ~ ., method="gbm",data=training,verbose=FALSE)
pred <- predict(modFit,testing)
boost.cm <- confusionMatrix(testing$classe,pred)
print( boost.cm)
```

## Random Forest

ran out of time for this run to make submission deadline
##```{r randomForest, cache=TRUE}
##modFit <- train(classe ~ ., data=training, method="rf",prox=TRUE)
##tree2 <- getTree(modFit$finalModel,k=2)
##pred <- predict(modFit,testing)
##rf.cm <- confusionMatrix(testing$classe,pred)
##print( rf.cm)
##```

# Results

Here are the prediction results, by model, with both the accuracy and out of sample error:

```{r summary}
model <- c("tree","lda","boost")
acc <- c(tree.cm$overall["Accuracy"],
         lda.cm$overall["Accuracy"],
         boost.cm$overall["Accuracy"])

oos <- c(1-tree.cm$overall["Accuracy"],
         1-lda.cm$overall["Accuracy"],
         1-boost.cm$overall["Accuracy"])

results <- data.frame( model,acc,oos)
names(results) <- c("Model","Accuracy","Out of sample error")
print(results)
```

